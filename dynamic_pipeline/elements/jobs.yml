jobs:
  build:
    executor: node-executor
    steps:
      - checkout
      - run:
          name: Install node dependencies
          command: |
            npm set cache .npm
            npm ci
      - run:
          command: npm run-script build
      - save_cache:
          paths:
            - dist
          key: dist-{{ epoch }}
      - save_cache:
          paths:
            - .npm
          key: dep-{{ epoch }}
      - run:
          name: Define current base
          command: echo "build test"

  deploy-backend:
    executor: node-executor
    steps:
      - run: echo "dep backend"

  deploy-frontend:
    executor: node-executor
    steps:
      - run: echo "dep frontend"
  
  lighthouse-check:
    docker:
      - image: cimg/node:14.18.2-browsers # own image for browser support
    steps:
      - checkout
      - restore_cache:
          keys:
            - dist
      - restore_cache:
          keys:
            - dep
      - run: ls -la -R ./dist
      - run:
          command: npm i -g @angular/cli
      - run:  
          name: Install lhci 
          command: sudo npm install -g @lhci/cli@0.8.x
      - browser-tools/install-chrome
      - browser-tools/install-chromedriver
      - run: 
          name: Run lhci
          command: lhci autorun

