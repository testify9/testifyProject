#!/bin/bash 
set -o pipefail

echo "Runngin script to generate pipeline config"
npm --version

ls
cd dynamic_pipeline
ls

mkdir configs/
ls
ls configs

touch configs/generated_config.yml
ls

frontend=false
backend=false

# check parameter count and assign to frontend / backend variables
while [ $# -gt 0 ]; do
  if [[ $1 == *"--"* ]]; then
      param="${1/--/}"
      declare $param=true
  fi
  shift
done

cat dynamic_pipeline/elements/head.yml > dynamic_pipeline/configs/generated_config.yml
cat dynamic_pipeline/elements/build.yml >> dynamic_pipeline/configs/generated_config.yml
if [ $frontend == true ]
then
  cat dynamic_pipeline/elements/build_f.yml >> dynamic_pipeline/configs/generated_config.yml
fi
if [ $backend == true ]
then
  cat dynamic_pipeline/elements/build_b.yml >> dynamic_pipeline/configs/generated_config.yml
fi
cat dynamic_pipeline/elements/commands.yml >> dynamic_pipeline/configs/generated_config.yml
cat dynamic_pipeline/elements/jobs.yml >> dynamic_pipeline/configs/generated_config.yml
